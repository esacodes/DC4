---
title: "Data Challenge 4"
author: "Nage Ngo, Carol Milton, Esa Schenck"
date: "3/24/2021"
output:   
  html_document:
    toc: true
    toc_depth: 3
    theme: cosmo
    highlight: tango
    toc_float: true
    code_folding: hide
---

#Working with tidytext

```{r set up, include = F}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F, error = F)
library(tidyverse)
library(tidytext)
library(tidygraph)
library(ggraph)
```

# Firewall 

```{r}
Firewall_04072012 <- readr::read_csv("DC4-data/Firewall/Firewall-04072012.csv")
```

Network 

```{r}
# id_sus <- id_sus %>%
#   full_join(ext_id)
# morning sunday: until 2014-06-08 13:16:27	

netw <- Firewall_04072012 %>% select(`Source IP`, `Destination IP`)
#node list
sources <- netw %>% distinct(`Source IP`) %>% rename( id = `Source IP`) %>% mutate(from = "from")
destinations <- netw %>% distinct(`Destination IP`) %>% rename(id = `Destination IP`)
nodes <- full_join(sources, destinations, by = "id") %>% distinct(id,.keep_all=T) %>% 
  mutate(f = ifelse(from=="from", "from", "to")) %>% select(id,f)

#edge list
per_route <- netw %>%  
  group_by(`Source IP`, `Destination IP`) %>%
  summarise(weight = n()) %>% 
  ungroup()
edges <- per_route %>% 
  left_join(nodes, by = c(`Source IP` = "id"))
edges <- edges %>% 
  left_join(nodes, by = c(`Destination IP` = "id"))
edges <- select(edges, from = `Source IP`, to = `Destination IP`, weight)
```

```{r}
# A tbl_graph consists of two tibbles: an edges tibble and a nodes tibble
routes_tidy <- tbl_graph(nodes = nodes, edges = edges, directed = TRUE) 

nw <- ggraph(routes_tidy, layout = "auto") 
  # geom_edge_link(aes(color = weight, width = weight), alpha = 0.7) + 
  # scale_edge_width(range = c(0.2, 2)) +
  # scale_edge_colour_gradient(low = "#f09c9c",
  #                            high = "#d60d0d",
  #                            space = "Lab") +
  # geom_node_point(aes(colour = ifelse(f=="from" ,"#0f0fa3","#635d5d")), show.legend = FALSE) + theme_graph()+
  # geom_node_text(aes(label = ifelse(f=="from", id, NA)), repel = TRUE) 

nw
```
